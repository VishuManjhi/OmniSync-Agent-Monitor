<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Restroboard Login</title>
    <link rel="icon" href="./favicon.ico.png" type="image/x-icon">
    <link rel="stylesheet" href="./styles/login.css">

    <!-- Theme Init (must run before body to prevent FOUC) -->
    <script>
        (function () {
            const theme = localStorage.getItem('restro_theme') || 'dark';
            document.documentElement.dataset.theme = theme;
        })();
    </script>
</head>

<body>
    <!-- Premium Background Decoration -->
    <div class="bg-blob bg-blob-1"></div>
    <div class="bg-blob bg-blob-2"></div>

    <div class="login-container">
        <div class="login-card">
            <div class="brand">
                <h1>Restroboard</h1>
                <p>View your Agents at a glance</p>
            </div>

            <!-- Single Login Form -->
            <div id="login-form">
                <div class="form-group">
                    <label>User ID</label>
                    <div class="input-wrapper">
                        <input type="text" class="input-field" placeholder="Enter User ID" id="user-id">
                    </div>
                </div>

                <div class="form-group">
                    <label>Password</label>
                    <div class="input-wrapper">
                        <input type="password" class="input-field" placeholder="Enter Password" id="password">
                    </div>
                </div>

                <div id="login-error" class="login-error hidden">
                    Invalid credentials
                </div>

                <button class="login-btn" onclick="handleLogin()">
                    Login
                </button>
            </div>

            <!-- Theme Toggle -->
            <button id="theme-toggle-btn"
                style="position: absolute; top: 15px; right: 15px; background: rgba(255,255,255,0.1); border: 1px solid rgba(255,255,255,0.2); border-radius: 8px; padding: 8px 12px; font-size: 16px; cursor: pointer;"
                title="Toggle Theme" onclick="toggleTheme()">‚òÄÔ∏è</button>

        </div>
    </div>

    <script>
        // Mock Database of Users
        const USERS = [
            { id: 'admin', pass: 'admin123', role: 'supervisor', name: 'Supervisor' },
            { id: 'sup1', pass: 'pass1', role: 'supervisor', name: 'Ops Lead' }
        ];
        function isAgentCandidate(id, pass) {
            const isMatch = (
                /^[aA]\d+$/.test(id) || // Matches a1, a4, A6, etc.
                id.toUpperCase().startsWith('A-') ||
                id.toLowerCase().startsWith('agent')
            );
            return isMatch && pass === '1234';
        }

        function handleLogin() {
            const idInput = document.getElementById('user-id');
            const passInput = document.getElementById('password');
            const errorMsg = document.getElementById('login-error');
            const btn = document.querySelector('.login-btn');

            const id = idInput.value.trim();
            const pass = passInput.value.trim();

            // Reset Error
            errorMsg.classList.add('hidden');

            if (!id || !pass) {
                errorMsg.textContent = "Please enter both ID and Password";
                errorMsg.classList.remove('hidden');
                return;
            }

            // Loading state
            btn.innerText = 'Authenticating...';
            btn.style.opacity = '0.7';
            btn.disabled = true;

            setTimeout(() => {
                // 1. Check Supervisors
                const supervisor = USERS.find(u => u.id === id && u.pass === pass);

                if (supervisor) {
                    sessionStorage.setItem('restro_auth', JSON.stringify({
                        id: supervisor.id,
                        role: 'supervisor',
                        name: supervisor.name,
                        loginTime: Date.now()
                    }));
                    window.location.href = './index.html';
                    return;
                }

                if (isAgentCandidate(id, pass)) {
                    // Normalize to lowercase (e.g. A1 -> a1)
                    const agentId = id.toLowerCase();
                    sessionStorage.setItem('restro_auth', JSON.stringify({
                        id: agentId,
                        role: 'agent',
                        loginTime: Date.now()
                    }));
                    window.location.href = `./agent.html?agentId=${encodeURIComponent(agentId)}`;
                    return;
                }

                // 3. Failed
                btn.innerText = 'Login';
                btn.style.opacity = '1';
                btn.disabled = false;
                errorMsg.textContent = "Invalid ID or Password";
                errorMsg.classList.remove('hidden');

            }, 600); // Simulated network delay
        }

        // Enter key support
        document.addEventListener('keypress', function (e) {
            if (e.key === 'Enter') {
                handleLogin();
            }
        });

        // Auto-focus ID field
        window.onload = function () {
            document.getElementById('user-id').focus();
            updateThemeIcon();
        };

        // Theme Toggle
        function toggleTheme() {
            const current = document.documentElement.dataset.theme || 'dark';
            const next = current === 'dark' ? 'light' : 'dark';
            document.documentElement.dataset.theme = next;
            localStorage.setItem('restro_theme', next);
            updateThemeIcon();
        }

        function updateThemeIcon() {
            const btn = document.getElementById('theme-toggle-btn');
            const theme = document.documentElement.dataset.theme || 'dark';
            if (btn) {
                btn.innerHTML = theme === 'light' ? 'üåô' : '‚òÄÔ∏è';
            }
        }
    </script>
</body>

</html>