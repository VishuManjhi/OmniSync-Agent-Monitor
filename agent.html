<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Agent Dashboard </title>
    <!--<link rel="stylesheet" href="/styles/main.css">-->
    <link rel="stylesheet" href="/styles/agent.css">
    <link rel="icon" href="./favicon.ico.png" type="image/x-icon">

    <script>
        // üõ°Ô∏è AUTH GUARD - Agent Level
        (function () {
            function checkAuth() {
                const authData = sessionStorage.getItem('restro_auth');
                const params = new URLSearchParams(window.location.search);
                const targetId = params.get('agentId');

                if (!authData) {
                    window.location.replace('./login.html');
                    return;
                }

                const auth = JSON.parse(authData);

                // If is agent, must match the ID in the URL
                if (auth.role === 'agent') {
                    if (!targetId || auth.id.toLowerCase() !== targetId.toLowerCase()) {
                        window.location.replace('./login.html');
                    }
                }
                // Supervisors can see any agent dashboard
            }
            checkAuth();
            window.addEventListener('pageshow', (event) => {
                if (event.persisted) checkAuth();
            });
        })();

        function handleLogout() {
            sessionStorage.removeItem('restro_auth');
            window.location.replace('./login.html');
        }
    </script>

    <!-- Theme Init (must run before body to prevent FOUC) -->
    <script>
        (function () {
            const theme = localStorage.getItem('restro_theme') || 'dark';
            document.documentElement.dataset.theme = theme;
        })();
    </script>
</head>

<body>
    <header class="header">
        <div class="header-left">
            <h1 class="logo">Agent Dashboard</h1>
            <div style="display: flex; gap: 12px; align-items: center;">
                <span class="agent-id" id="agent-id">ID: <span id="current-agent-id">...</span></span>
                <span id="agent-display-name"
                    style="font-size: 14px; font-weight: 800; color: var(--agent-accent-cyan); text-transform: none; letter-spacing: normal;">Loading
                    Profile...</span>
            </div>
        </div>
        <div class="header-right">
            <div class="current-status" id="current-status">
                <span class="status-badge" id="status-badge">Offline</span>
            </div>
            <button id="theme-toggle-btn" class="action-btn"
                style="margin-left: 10px; padding: 6px 12px; font-size: 16px;" title="Toggle Theme">‚òÄÔ∏è</button>
            <button class="action-btn" style="margin-left: 10px; padding: 6px 12px; font-size: 13px;"
                onclick="handleLogout()">Logout</button>
        </div>
    </header>


    <main class="main-container">
        <!-- Clock In/Out Section -->
        <section class="card session-management">
            <h2 class="section-title">Operations</h2>
            <div class="clock-controls">
                <button id="clock-in-btn" class="action-btn btn-primary">Clock In</button>
                <button id="clock-out-btn" class="action-btn btn-secondary" disabled>Clock Out</button>
                <button id="break-in-btn" class="action-btn btn-warning" disabled>Break In</button>
                <button id="break-out-btn" class="action-btn btn-info" disabled>Break Out</button>
                <button id="on-call-btn" class="action-btn">On Call</button>
            </div>

            <div class="session-info">
                <div class="info-item">
                    <span class="info-label">Shift Start</span>
                    <span class="info-value" id="clock-in-time">--:--:--</span>
                </div>
                <div class="info-item">
                    <span class="info-label">Status</span>
                    <span class="info-value" id="session-status">OFFLINE</span>
                </div>
                <div class="info-item">
                    <span class="info-label">Break Counter</span>
                    <span class="info-value" id="break-duration">00:00:00</span>
                </div>
            </div>
        </section>

        <!-- Ticket Form Section -->
        <section class="card ticket-submission">
            <h2 class="section-title">Support Desk</h2>
            <form id="ticket-form" class="ticket-form">
                <div class="form-group">
                    <label>Attachments</label>
                    <input type="file" id="attachmentInput" accept="audio/*,image/*" />
                    <div id="attachmentPreview" style="margin-top:12px;"></div>
                </div>

                <div class="form-group">
                    <label for="issue-type">Case Type</label>
                    <select id="issue-type" name="issueType" required>
                        <option value="">Select Priority/Tier</option>
                        <option value="FOH">FOH - Front of House</option>
                        <option value="BOH">BOH - Back of House</option>
                        <option value="KIOSK">KIOSK - Terminal</option>
                        <option value="other">Other - Custom</option>
                    </select>
                </div>

                <div class="form-group">
                    <label for="description">Case Description</label>
                    <textarea id="description" name="description" rows="3" required
                        placeholder="Detail the technical or operational bottleneck..."></textarea>
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label for="call-duration">Call Duration (min)</label>
                        <input type="number" id="call-duration" name="callDuration" min="0" step="1" placeholder="0">
                    </div>
                </div>

                <button type="submit" class="action-btn btn-primary" style="width:100%">Submit Document</button>
            </form>
        </section>

        <!-- History Section -->
        <section class="tickets-section">
            <h2 class="section-title">Personal Ticket History</h2>
            <div id="my-tickets"></div>
        </section>
    </main>
    <script>
        const params = new URLSearchParams(window.location.search);
        window.AGENT_ID = params.get('agentId') || 'a1';
    </script>

    <script type="module" src="/src/js/agent.js"></script>
</body>

</html>