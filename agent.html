<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Agent Dashboard </title>
    <!--<link rel="stylesheet" href="/styles/main.css">-->
    <link rel="stylesheet" href="/styles/agent.css">
    <link rel="icon" href="./favicon.ico.png" type="image/x-icon">

    <script>
        // ðŸ›¡ï¸ AUTH GUARD - Agent Level
        (function () {
            function checkAuth() {
                const authData = sessionStorage.getItem('restro_auth');
                const params = new URLSearchParams(window.location.search);
                const targetId = params.get('agentId');

                if (!authData) {
                    window.location.replace('./login.html');
                    return;
                }

                const auth = JSON.parse(authData);

                // If is agent, must match the ID in the URL
                if (auth.role === 'agent') {
                    if (!targetId || auth.id.toLowerCase() !== targetId.toLowerCase()) {
                        window.location.replace('./login.html');
                    }
                }
                // Supervisors can see any agent dashboard
            }
            checkAuth();
            window.addEventListener('pageshow', (event) => {
                if (event.persisted) checkAuth();
            });
        })();

        function handleLogout() {
            sessionStorage.removeItem('restro_auth');
            window.location.replace('./login.html');
        }
    </script>
</head>

<body>
    <header class="header">
        <div class="header-left">
            <h1 class="logo">Agent Dashboard</h1>
            <span class="agent-id" id="agent-id">Agent Id: <span id="current-agent-id">...</span></span>
        </div>
        <div class="header-right">
            <div class="current-status" id="current-status">
                <span class="status-badge" id="status-badge">Offline</span>
            </div>
            <button class="action-btn" style="margin-left: 10px; padding: 6px 12px; font-size: 13px;"
                onclick="handleLogout()">Logout</button>
        </div>
    </header>


    <main class="main-container">
        <!-- Clock In/Out Section -->
        <section class="card section-card">
            <h2 class="section-title">Session Management</h2>
            <div class="clock-controls">
                <button id="clock-in-btn" class="action-btn btn-primary">Clock In</button>
                <button id="clock-out-btn" class="action-btn btn-secondary" disabled>Clock Out</button>
                <button id="break-in-btn" class="action-btn btn-warning" disabled>Break In</button>
                <button id="break-out-btn" class="action-btn btn-info" disabled>Break Out</button>
                <button id="on-call-btn">On Call</button>

            </div>
            <div class="session-info">
                <div class="info-item">
                    <span class="info-label">Clock In Time:</span>
                    <span class="info-value" id="clock-in-time">--:--:--</span>
                </div>
                <div class="info-item">
                    <span class="info-label">Current Status:</span>
                    <span class="info-value" id="session-status">Not Clocked In</span>
                </div>
                <div class="info-item">
                    <span class="info-label">Break Duration:</span>
                    <span class="info-value" id="break-duration">00:00:00</span>
                </div>
            </div>
        </section>

        <!-- Ticket Form Section -->
        <section class="card section-card">
            <h2 class="section-title">Raise Ticket</h2>
            <form id="ticket-form" class="ticket-form">
                <label style="display:block; margin-top:12px;">
                    Attach call recording / image:
                    <input type="file" id="attachmentInput" accept="audio/*,image/*" />
                </label>
                <div id="attachmentPreview" style="margin-top:10px;"></div>
                <div class="form-group">
                    <label for="issue-type">Type of Issue *</label>
                    <select id="issue-type" name="issueType" required>
                        <option value="">Select issue type</option>
                        <option value="FOH">FOH</option>
                        <option value="BOH">BOH</option>
                        <option value="KIOSK">KIOSK</option>
                        <option value="other">Other</option>
                    </select>
                </div>

                <div class="form-group">
                    <label for="description">Description *</label>
                    <textarea id="description" name="description" rows="4" required
                        placeholder="Describe the issue"></textarea>
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label for="call-duration">Call Duration</label>
                        <input type="number" id="call-duration" name="callDuration" min="0" step="1" placeholder="0">
                    </div>
                </div>

                <button type="submit" class="action-btn btn-primary">Submit Ticket</button>
            </form>
        </section>
        <section>
            <h3>My Tickets</h3>
            <div id="my-tickets"></div>
        </section>

    </main>
    <script>
        const params = new URLSearchParams(window.location.search);
        window.AGENT_ID = params.get('agentId') || 'a1';
    </script>

    <script type="module" src="/src/js/agent.js"></script>
</body>

</html>